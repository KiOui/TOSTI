{% load static %}

<h2>Age check</h2>
{% if is_over_18 %}
    <div class="alert alert-success">
        You have been verified to be over 18 years old.
    </div>
{% else %}
    <div class="alert alert-danger">
        You have not been verified to be over 18 years old yet, please verify down below.
    </div>
    <button class="btn btn-primary mx-auto" data-bs-toggle="modal" data-bs-target="#verify-age-modal">Verify your age
    </button>

    <div class="modal" id="verify-age-modal" tabindex="-1" role="dialog" aria-labelledby="verify-age-modal-label"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Verify your age</h3>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <section class="yivi-web-form" id="yivi-web-form"></section>
                </div>
                <div class="modal-footer"></div>
            </div>
        </div>
    </div>
    <script src="{% static "age/js/yivi.js" %}" type="text/javascript"></script>
    <script>
        const yiviWeb = yivi.newWeb({
            debugging: true,
            element: '#yivi-web-form',
            session: {
                start: {
                    url: () => '{% url "v1:yivi_start" %}',
                    method: 'POST',
                    headers: {
                        "X-CSRFToken": get_csrf_token(),
                    },
                },
                result: {
                    url: (o, {sessionPtr, sessionToken}) => `/api/v1/age/session/${sessionToken}/result/`,
                    method: 'GET',
                    headers: {
                        "X-CSRFToken": get_csrf_token(),
                    },
                }
            }
        });

        yiviWeb.start()
            .then(result => console.log("Successful disclosure! ðŸŽ‰", result))
            .catch(error => console.error("Couldn't do what you asked ðŸ˜¢", error));
    </script>
{% endif %}
